<!DOCTYPE HTML>
<html>
<head>
<title>Reminiscens</title>
<script src="cordova-2.4.0.js"></script>

<!--<script src="http://code.jquery.com/jquery.js"></script>-->

<script src="http://code.jquery.com/jquery-latest.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.0.0.js"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<script src="bootstrap/js/bootstrap.js"></script>
<link href="css/StyleOverlay.css" rel="stylesheet">
<script src="js/GestioneOverlay.js"></script>
<link href="kendo/styles/kendo.common.min.css" rel="stylesheet" />
<link href="kendo/styles/kendo.default.min.css" rel="stylesheet" />
<link href="css/StyleRoot.css" rel="stylesheet" />
<script src="kendo/js/kendo.web.min.js"></script>
<script type="text/javascript" src="js/recorder.js"></script>
<script type="text/javascript" src="js/GestioneKendoEditor.js"></script>
<script type="text/javascript" src="js/GestioneFoto.js"></script>
<script type="text/javascript" src="js/GestioneRecorderHTML.js"></script>
<script type="text/javascript" src="js/storage/jquery.storageapi.js"></script>
<script type="text/javascript" src="js/storage/jquery.cookie.js"></script>
<script type="text/javascript" src="js/json/json2.js"></script>
<script type="text/javascript" src="js/GestioneImmagini.js"></script>
<script type="text/javascript" src="js/SaveStoryJSON.js"></script>

<!-- Add mousewheel plugin (this is optional) -->
<script type="text/javascript" src="fancybox/lib/jquery.mousewheel-3.0.6.pack.js"></script>

<!-- Add fancyBox -->
<link rel="stylesheet" href="fancybox/source/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="fancybox/source/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen" />
<script type="text/javascript" src="fancybox/source/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="fancybox/source/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet" href="fancybox/source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" type="text/css" media="screen" />
<script type="text/javascript" src="fancybox/source/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>

<!-- Add jQuery library --><!--<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>-->

<script type="text/javascript" src="js/sha1.js"></script>
<script type="text/javascript" src="js/GestioneSchermate&Menu.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script type="text/javascript" src="js/GestioneRegistrazione.js"></script>
<script type="text/javascript" src="js/GestioneSynchronizeStories.js"></script>
<script type="text/javascript" src="js/app/files.js"></script>
	<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="js/lib/jquery.file.upload/js/vendor/jquery.ui.widget.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="js/lib/jquery.file.upload/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="js/lib/jquery.file.upload/js/jquery.fileupload.js"></script>
<script type="text/javascript" src="js/GestioneVariabiliPersona.js">
</script><script type="text/javascript" src="js/GestioneQuestion.js"></script>


<script>  	
     function onLoad(){
          document.addEventListener("deviceready", onDeviceReady, true);
     }
     function onDeviceReady(){
          //navigator.notification.alert("PhoneGap is working!!");
     }	
	 function editor()
	 {
		var editor = $("#editor").data("kendoEditor");
		//alert(editor.value());
		$("#debug").text(editor.value());
	 }
	 /*function storage() {
		/*var storage =$.localStorage;
		//alert(storage.get('prova'));
		//var obj = JSON.parse(storage.get('prova'));
		alert(storage.get('prova').titolo);
	 	//$("#debug").text(storage.get('prova'));*/
		
		
		//EliminaIntestazioneDataImg();
		
		//alert();
	 //}
	 
	 
	 var tokern;
	 var Storie = [];
	 var MieStorie = [];
	 var NumeroPaginaMieStorie = 0;
	 var NumeroPaginaMieFoto = 0;
	 var decade = 1940;
	 var MieStorieVisible = [];
	 var sessionKey;
	 var personId;
	 var imgStoriaUrl = [];
	 var imgStoriaHashcode = [];
	 var imgStoriaFilename = [];
	 var birthYear;
	 var personalQuestion = [];
	 var decadeQuestion = [];
	 
	 
	 function InizializzaStorieDecade()
	 {
 		MieStorie.MilleNovecento = [];
		MieStorie.MilleNovecentoDieci = [];
 		MieStorie.MilleNovecentoVenti = [];
		MieStorie.MilleNovecentoTrenta = [];
 		MieStorie.MilleNovecentoQuaranta = [];
		MieStorie.MilleNovecentoCinquanta = [];
 		MieStorie.MilleNovecentoSessanta = [];
		MieStorie.MilleNovecentoSettanta = [];
 		MieStorie.MilleNovecentoOttanta = [];
		MieStorie.MilleNovecentoNovanta = [];
 		MieStorie.Duemila = [];
		MieStorie.DuemilaDieci = [];
		MieStorie.DuemilaVenti = [];
	 }
	 
	 function AggiungiStoriaDecade(newStory, decade)
	 {
		switch(parseInt(decade))
		{
			case 1900:
 				MieStorie.MilleNovecento.push(newStory);
  				break;
			case 1910:
				MieStorie.MilleNovecentoDieci.push(newStory);
	  			break;
			case 1920:
 				MieStorie.MilleNovecentoVenti.push(newStory);
  				break;
			case 1930:
				MieStorie.MilleNovecentoTrenta.push(newStory);
	  			break;
			case 1940:
 				MieStorie.MilleNovecentoQuaranta.push(newStory);
  				break;
			case 1950:
				MieStorie.MilleNovecentoCinquanta.push(newStory);
	  			break;
			case 1960:
 				MieStorie.MilleNovecentoSessanta.push(newStory);
  				break;
			case 1970:
				MieStorie.MilleNovecentoSettanta.push(newStory);
	  			break;
			case 1980:
 				MieStorie.MilleNovecentoOttanta.push(newStory);
  				break;
			case 1990:
				MieStorie.MilleNovecentoNovanta.push(newStory);
	  			break;
			case 2000:
 				MieStorie.Duemila.push(newStory);
  				break;
			case 2010:
				MieStorie.DuemilaDieci.push(newStory);
	  			break;
			case 2020:
				MieStorie.DuemilaVenti.push(newStory);
	  			break;
		}
	 }
	 
	 
	 function RecuperaStorieDecade()
	 {
		 switch(parseInt(decade))
		{
			case 1900:
 				return MieStorie.MilleNovecento;
  				break;
			case 1910:
				return MieStorie.MilleNovecentoDieci;
	  			break;
			case 1920:
 				return MieStorie.MilleNovecentoVenti;
  				break;
			case 1930:
				return MieStorie.MilleNovecentoTrenta;
	  			break;
			case 1940:
 				return MieStorie.MilleNovecentoQuaranta;
  				break;
			case 1950:
				return MieStorie.MilleNovecentoCinquanta;
	  			break;
			case 1960:
 				return MieStorie.MilleNovecentoSessanta;
  				break;
			case 1970:
				return MieStorie.MilleNovecentoSettanta;
	  			break;
			case 1980:
 				return MieStorie.MilleNovecentoOttanta;
  				break;
			case 1990:
				return MieStorie.MilleNovecentoNovanta;
	  			break;
			case 2000:
 				return MieStorie.Duemila;
  				break;
			case 2010:
				return MieStorie.DuemilaDieci;
	  			break;
			case 2020:
				return MieStorie.DuemilaVenti;
	  			break;
		}
	 }	
	
	function Timeline()
	{	
		//alert(sessionKey);	
		InizializzaStorieDecade();
		/*$.getJSON("http://test.reminiscens.me/lifeapi/person/3/timeline",function(timeline)*/
		$.ajax({
            type:"GET",
            /*beforeSend: function (request)
            {
                request.setRequestHeader("PLAY_SESSION", sessionKey);
            },*/
           url: "http://test.reminiscens.me/lifeapi/person/"+personId+"/timeline",
			//url: "http://test.reminiscens.me/lifeapi/person/"+3+"/timeline",
            //data: "json=" + escape(JSON.stringify(createRequestObject)),
            processData: false,
            dataType: "json",
			contentType:"application/json",
        	error: function (data) {

        	    alert("error");

        	},
			success: function(timeline) 
			{
				//alert(timeline.aboutPerson.personId );
				var storyList = timeline.storyList;
				
				var i = 0;
				while(storyList[i] != null)
				{
					//alert(storyList[i].storyId);
					var mementoList = storyList[i].mementoList;
					var j = 0;
					var newStory = new Object;
					newStory.headline = storyList[i].headline;
					newStory.location = new Object;
					newStory.location.location_textual = "";
					newStory.location.city = storyList[i].location.city;
					newStory.startDate = new Object;
					newStory.startDate.exactDate = storyList[i].startDate.exactDateAsString;
					newStory.text = storyList[i].text;
					var vettImm = [];
					while(mementoList[j] != null)
					{						
						if(mementoList[j].category == "PICTURE")
						{
							//alert(mementoList[j].url);						
							var Imm = new Object;
							Imm.url = mementoList[j].url;
							Imm.fileHashcode = mementoList[j].fileHashcode;
							Imm.thumbnailUrl = mementoList[j].thumbnailUrl;
							//alert(Imm.src);s
							vettImm.push(Imm);							
						}						
						j++;
					}
					newStory.mementoList = vettImm;
					AggiungiStoriaDecade(newStory, storyList[i].startDate.decade);
					//MieStorie.push(newStory);
					i++;
				}
				
				var storage = $.localStorage;
				storage.set('mieStorie',MieStorie);
				
				
				MieStorieVisible = RecuperaStorieDecade();
				/*if(MieStorieVisible.length<2) //caso in cui ci sia da stampare solo una foto o nessuna
				{
					stampaMieFoto(0,MieStorieVisible.length);
					stampaMieStorie(0,MieStorieVisible.length);
				}
				else //caso in cui ci siano almeno 2 foto quindi stampo le prime 2
				{
					stampaMieFoto(0,2);
					stampaMieStorie(0,2);
				}*/	
				
				stampaMieFoto(0,MieStorieVisible.length);
				stampaMieStorie(0,MieStorieVisible.length);
				aggiungiEventoFancyBox();
		/*);
	}*/
				//alert(msg.aboutPerson.personId);
				
				GestioneSchermate();
            }
        	
   		});
	}	 
	 
 	
	function aggiungiEventoFancyBox()
	{
		$(".fancyboxStorie").fancybox({
					'showCloseButton'	: false,
					afterLoad : function() {
						//alert(Storie.length);
    						this.title = "<div><h1>" + Storie[this.index].headline +"</h1><h5>" + Storie[this.index].text + "</h5>  </div>";
						//this.title = "<div><h1>" + "hola" +"</h1> </div>";
   					},
					'helpers' : { 
    					title : { type : 'inside' }
   					} // helpers
				});
		$(".fancyboxMieStorie").fancybox({
					'showCloseButton'	: false,
					afterLoad : function() {
							this.title = "<div><h1>" + MieStorieVisible[this.index].headline + "</h1><h5>" + MieStorieVisible[this.index].text + "</h5>  </div>";
						//this.title = "<div><h1>" + "hola" +"</h1> </div>";
   					},
					'helpers' : { 
    					title : { type : 'inside' }
   					} // helpers
				});
	}
	
	/*$(document).ready(function() {
		var cities = [];
		var idCities = [];
		var tmp = $.getJSON('json/cities.json',function(tmp)
		{ //return timeline				
			for (var i = 0; i < tmp.length; i++) {
				//alert(tmp[i].name);
   				cities.push(tmp[i].name);
				idCities.push(tmp[i].cityId);
			}
			
			$('#dove').autocomplete({
				source:cities,
				minLength: 3 
			});		
		
		});
		
	});*/
	
	$(document).ready(function() {	
		
		var j  = 1;
		document.getElementById("decade").innerHTML += "<option value='" + 0 +"'>" + "decade" + "</option>";
		for(var i = 1900;i <= 2020;i = i + 10)
		{
			document.getElementById("decade").innerHTML += "<option value='" + j +"'>" + i + "</option>";
			j++;
		}
		

		$.ajaxSetup({
    			beforeSend: function(xhr) {
        			xhr.setRequestHeader("PLAY_SESSION", sessionKey);
    			}
		});	
		
			
		//var storage =$.localStorage;
		sessionKey = GetSessionKey();
		personId = GetPersonId();
		birthYear = GetPersonBirthDate().split('-')[0];
		//alert(birthYear);
		//alert(personId);
		//alert(sessionKey);
		
		
		
		
		
		$("#quando").kendoDatePicker()
					.closest(".k-widget")
                    .attr("id", "datepicker_wrapper");
		
		
		decade = 1940;
		$("#lbldebug").text("Non ci sono ancora storie del " + decade + "!");
		$("#FotoDelTempo").text("Com'era questo posto attorno al " + decade);
		$("#TueFotoDelTempo").text("Le tue foto attorno al " + decade);
		$("#StorieDelTempo").text("Che cosa succedeva nel " + decade);
		$("#TueStorieDelTempo").text("Le tue storie nel " + decade);
		
		
		downloadQuestion(birthYear,decade);
	
					
		
		var jsonObj = new Object;
	
		jsonObj.headline = "Foto 1";
		jsonObj.location = new Object;
		jsonObj.location.location_textual = "";
		jsonObj.startDate = new Object;
		jsonObj.startDate.exactDate = "";
		jsonObj.text = "2 ottobre 1950 - nasce il fumetto Charlie Brown, dalla penna di Charles M. Schulz...";
		
		var vettImm = [];
		var Imm = new Object;
		Imm.url = "img/comera1.jpg";
		vettImm.push(Imm);
		jsonObj.mementoList = vettImm;
		Storie.push(jsonObj);
		
		//alert(Storie[0].titolo);
		
		var jsonObj = new Object;
	
		jsonObj.headline = "Foto 2";
		jsonObj.location = new Object;
		jsonObj.location.location_textual = "";
		jsonObj.startDate = new Object;
		jsonObj.startDate.exactDate = "";
		jsonObj.text = "09 maggio 1950 - Nasce la comunitÃ  europea...";
		
		var vettImm = [];
		var Imm = new Object;
		Imm.url = "img/comera3.jpg";
		vettImm.push(Imm);
		jsonObj.mementoList = vettImm;
		Storie.push(jsonObj);
		
		for(var i = 0;i<8;i++)
		{
			var jsonObj = new Object;
	
		jsonObj.headline = "Foto 2";
		jsonObj.location = new Object;
		jsonObj.location.location_textual = "";
		jsonObj.startDate = new Object;
		jsonObj.startDate.exactDate = "";
		jsonObj.text = "09 maggio 1950 - Nasce la comunitÃ  europea...";
		
		var vettImm = [];
		var Imm = new Object;
		Imm.url = "img/comera3.jpg";
		vettImm.push(Imm);
		jsonObj.mementoList = vettImm;
		Storie.push(jsonObj);
		}
		
		for (i=0; i<Storie.length; i++) { 
			document.getElementById("divFotoDelTempo").innerHTML += "<div class='immaginiFoto'><a class='fancyboxStorie' rel='gallery1' href='" + Storie[i].mementoList[0].url + "' title='" + Storie[i].headline + "' > <img style='max-width:195px;max-height:140px;' src='" + Storie[i].mementoList[0].url + "' alt='' /> </a></div>";
			/*document.getElementById("divStorieDelTempo").innerHTML += "<div class='immagini'><div style='line-height:200px;max-height:200px;width:220px;float: left;'> <a class='fancyboxStorie' rel='gallery3' href='" + Storie[i].mementoList[0].url + "' title='" + Storie[i].headline + "' > <img style='vertical-align:middle;max-height:200px;width:220px;' src='" + Storie[i].mementoList[0].url + "' alt='' /> </a></div><div class='text'>" + Storie[i].text +"</div></div>";*/
		}
		
		
		//Login();
		Timeline();
});

function controlloStampaPagine()
{
	if(MieStorieVisible.length>NumeroPaginaMieFoto * 2 + 1) //caso in cui ci siano 2 foto da stampare
	{
		stampaMieFoto(NumeroPaginaMieFoto * 2,NumeroPaginaMieFoto * 2 +2);
	}
	else
	{
		stampaMieFoto(NumeroPaginaMieFoto * 2,NumeroPaginaMieFoto * 2 +1);	
	}
}


function DecadeIsEmpty()
{
	switch(parseInt(decade))
		{
			case 1900:
				if(MieStorie.MilleNovecento.length !=0)
					return false;
  				break;
			case 1910:
				if(MieStorie.MilleNovecentoDieci.length !=0)
					return false;
	  			break;
			case 1920:
 				if(MieStorie.MilleNovecentoVenti.length !=0)
					return false;
  				break;
			case 1930:
				if(MieStorie.MilleNovecentoTrenta.length !=0)
					return false;
	  			break;
			case 1940:
				//alert(MieStorie.MilleNovecentoQuaranta.length);
 				if(MieStorie.MilleNovecentoQuaranta.length !=0)
					return false;
  				break;
			case 1950:
				//alert(MieStorie.MilleNovecentoCinquanta.length);
				if(MieStorie.MilleNovecentoCinquanta.length !=0)
					return false;
	  			break;
			case 1960:
 				if(MieStorie.MilleNovecentoSessanta.length !=0)
					return false;
  				break;
			case 1970:
				if(MieStorie.MilleNovecentoSettanta.length !=0)
					return false;
	  			break;
			case 1980:
 				if(MieStorie.MilleNovecentoOttanta.length !=0)
					return false;
  				break;
			case 1990:
				if(MieStorie.MilleNovecentoNovanta.length !=0)
					return false;
	  			break;
			case 2000:
 				if(MieStorie.Duemila.length !=0)
					return false;
  				break;
			case 2010:
				if(MieStorie.DuemilaDieci.length !=0)
					return false;
	  			break;
			case 2020:
				if(MieStorie.DuemilaVenti.length !=0)
					return false;
	  			break;
		}
		
		return true;
}

function controlloStampaPagineStorie()
{
	if(MieStorieVisible.length>NumeroPaginaMieStorie * 2 + 1) //caso in cui ci siano 2 foto da stampare
	{
		stampaMieStorie(NumeroPaginaMieStorie * 2,NumeroPaginaMieStorie * 2 +2);
	}
	else
	{
		stampaMieStorie(NumeroPaginaMieStorie * 2,NumeroPaginaMieStorie * 2 +1);	
	}
}

function avantiStorie()
{
	NumeroPaginaMieStorie++;
	//alert(NumeroPaginaMieStorie);
	if(MieStorieVisible.length <= NumeroPaginaMieStorie * 2){
		NumeroPaginaMieStorie = 0;
	}
	//alert(NumeroPaginaMieStorie);
	controlloStampaPagineStorie();
}

function indietroStorie()
{
	NumeroPaginaMieStorie--;
	//alert(NumeroPaginaMieStorie);
	if(NumeroPaginaMieStorie < 0){
		//prendo la metà + eventuale immagine singola (se dim è dispari) - uno perchè le pagine partono da 0!!
		NumeroPaginaMieStorie = Math.floor(MieStorieVisible.length/2) + MieStorieVisible.length%2 - 1;
	}
	//alert(NumeroPaginaMieStorie);
	controlloStampaPagineStorie();
}



function avanti()
{
	NumeroPaginaMieFoto++;
	//alert(NumeroPaginaMieStorie);
	if(MieStorieVisible.length <= NumeroPaginaMieFoto * 2){
		NumeroPaginaMieFoto = 0;
	}
	//alert(NumeroPaginaMieStorie);
	controlloStampaPagine();
}

function indietro()
{
	NumeroPaginaMieFoto--;
	//alert(NumeroPaginaMieStorie);
	if(NumeroPaginaMieFoto < 0){
		//prendo la metà + eventuale immagine singola (se dim è dispari) - uno perchè le pagine partono da 0!!
		NumeroPaginaMieFoto = Math.floor(MieStorieVisible.length/2) + MieStorieVisible.length%2 - 1;
	}
	//alert(NumeroPaginaMieStorie);
	controlloStampaPagine();
}

function stampaMieFoto(inizio, fine)
{
	//alert(inizio + "  " + fine);
	
	var i;
	document.getElementById("divMieFotoDelTempo").innerHTML = "";
	//document.getElementById("divMieFotoDelTempo").innerHTML += "<button id='indietro' onClick='indietro'>Indietro</button> <button id='avanti' onClick='avanti'>Avanti</button></br>";
	for (i=inizio; i<fine; i++) { 		
		//alert(MieStorie[i].immagini[0].src);
		if(MieStorieVisible[i].mementoList[0] != null)
		{
			if(MieStorieVisible[i].mementoList[0].thumbnailUrl == null)
			{
				document.getElementById("divMieFotoDelTempo").innerHTML += "<div class='immaginiFoto'><a class='fancyboxMieStorie' rel='gallery2' href='" + MieStorieVisible[i].mementoList[0].url + "' title='" + MieStorieVisible[i].headline + "' > <img style='max-width:195px;max-height:140px;' src='" + MieStorieVisible[i].mementoList[0].url + "' alt='' /> </a></br></div>";
			}
			else  //stampo attraverso hashcode
			{				
				document.getElementById("divMieFotoDelTempo").innerHTML += "<div class='immaginiFoto'><a class='fancyboxMieStorie' rel='gallery2' href='" + "http://test.reminiscens.me/file/" + "LARGE_" + MieStorieVisible[i].mementoList[0].thumbnailUrl  + "' title='" + MieStorieVisible[i].headline + "' > <img style='max-width:195px;max-height:140px;' src='" + "http://test.reminiscens.me//lifeapi/file/" + MieStorieVisible[i].mementoList[0].fileHashcode + "/SMALL" + "' alt='' /> </a></br></div>";
			}
				
		}
		else
		{
			/*document.getElementById("divMieFotoDelTempo").innerHTML += "<a class='fancybox' rel='gallery1' href='" + "images/no_image.png" + "' title='" + MieStorieVisible[i].titolo + "' > <img class='immaginiFoto' src='" + "images/no_image.png" + "' alt='' /> </a></br>";*/
		}
	}
}

function stampaMieStorie(inizio, fine)
{
	//alert(inizio + "  " + fine);
	
	var i;
	document.getElementById("divMieStorieDelTempo").innerHTML = "";
	//document.getElementById("divMieStorieDelTempo").innerHTML += "<button id='indietro' onClick='indietroStorie()'>Indietro</button> <button id='avanti' onClick='avantiStorie()'>Avanti</button></br>";
	for (i=inizio; i<fine; i++) { 
						
		//alert(MieStorie[i].immagini[0].src);
		if(MieStorieVisible[i].mementoList[0] != null)
		{
			if(MieStorieVisible[i].mementoList[0].fileHashcode == null)
			{
				document.getElementById("divMieStorieDelTempo").innerHTML += "<div style=' width:440px; border-style:solid;border-width:2px;border-color:#000; height:140px; margin-left:15px; margin-bottom:5px;'><div style=' float:left; width:110px; text-align:center; height:140px;'><h5>" + MieStorieVisible[i].startDate.exactDate + "</h5>	<h5>" + MieStorieVisible[i].location.city + "</h5></div><div style=' float:left;width:216px; text-align:center;background: rgba(0,0,0,0.7);color: #FFF;height:136px; padding: 2px; text-align:left;'><h3 style='text-align:center;'>" + MieStorieVisible[i].headline + "</h3>" + MieStorieVisible[i].text + "</div>	<div style='float:left;width:110px; text-align:center;background: rgba(0,0,0,0.7);color: #FFF;height:140px; line-height:140px; vertical-align:middle;'><img style='max-width:110px;' src='" + MieStorieVisible[i].mementoList[0].url + "' alt='' /></div></div>";
				/*document.getElementById("divMieStorieDelTempo").innerHTML += "<div class='immagini'><div style='line-height:200px;max-height:200px;width:220px;float: left;'> <a class='fancyboxMieStorie' rel='gallery4' href='" + MieStorieVisible[i].mementoList[0].url + "' title='" + MieStorieVisible[i].headline + "' > <img style='vertical-align:middle;max-height:200px;max-width:220px;' src='" + MieStorieVisible[i].mementoList[0].url + "' alt='' /> </a></div><div class='text'>" + MieStorieVisible[i].text +"</div></div>";*/
			}
			else
			{
				document.getElementById("divMieStorieDelTempo").innerHTML += "<div style=' width:440px; border-style:solid;border-width:2px;border-color:#000; height:140px; margin-left:15px; margin-bottom:5px;'><div style=' float:left; width:110px; text-align:center; height:140px;'><h5>" + MieStorieVisible[i].startDate.exactDate + "</h5>	<h5>" + MieStorieVisible[i].location.city + "</h5></div><div style=' float:left;width:216px; text-align:center;background: rgba(0,0,0,0.7);color: #FFF;height:136px; padding: 2px; text-align:left;'><h3 style='text-align:center;'>" + MieStorieVisible[i].headline + "</h3>" + MieStorieVisible[i].text + "</div>	<div style='float:left;width:110px; text-align:center;background: rgba(0,0,0,0.7);color: #FFF;height:140px; line-height:140px; vertical-align:middle;'><img style='max-width:110px;' src='http://test.reminiscens.me//lifeapi/file/" + MieStorieVisible[i].mementoList[0].fileHashcode + "/THUMBNAIL' alt='' /></div></div>";
				/*document.getElementById("divMieStorieDelTempo").innerHTML += "<div class='immagini'><div style='line-height:200px;max-height:200px;width:220px;float: left;'> <a class='fancyboxMieStorie' rel='gallery4' href='" + "http://test.reminiscens.me/file/" + "LARGE_" + MieStorieVisible[i].mementoList[0].thumbnailUrl + "' title='" + MieStorieVisible[i].headline + "' > <img style='vertical-align:middle;max-height:200px;max-width:220px;' src='" + "http://test.reminiscens.me//lifeapi/file/" + MieStorieVisible[i].mementoList[0].Hashcode + "/THUMBNAIL" + "' alt='' /> </a></div><div class='text'>" + MieStorieVisible[i].text +"</div></div>";*/
			}
		}
		else
		{
			document.getElementById("divMieStorieDelTempo").innerHTML += "<div style=' width:440px; border-style:solid;border-width:2px;border-color:#000; height:140px; margin-left:15px; margin-bottom:5px;'><div style=' float:left; width:110px; text-align:center; height:140px;'><h5>" + MieStorieVisible[i].startDate.exactDate + "</h5>	<h5>" + MieStorieVisible[i].location.city + "</h5></div><div style=' float:left;width:216px; text-align:center;background: rgba(0,0,0,0.7);color: #FFF;height:136px; padding: 2px; text-align:left;'><h3 style='text-align:center;'>" + MieStorieVisible[i].headline + "</h3>" + MieStorieVisible[i].text + "</div>	<div style='float:left;width:110px; text-align:center;background: rgba(0,0,0,0.7);color: #FFF;height:140px; line-height:140px; vertical-align:middle;'><img style='max-width:110px;' src='" + "images/story-book.jpg" + "' alt='' /></div></div>";
			/*document.getElementById("divMieStorieDelTempo").innerHTML += "<div class='immagini'><div style='line-height:200px;max-height:200px;width:220px;float: left;'> <a class='fancyboxMieStorie' rel='gallery4' href='" + "images/story-book.jpg" + "' title='" + MieStorieVisible[i].headline + "' > <img style='vertical-align:middle;max-height:200px;max-width:220px;' src='" + "images/story-book.jpg" + "' alt='' /> </a></div><div class='text'>" + MieStorieVisible[i].text +"</div></div>";*/
		}
	}
}

function YearToDecade(anno)
{
	var tmp = anno/10;
	//alert(parseInt(tmp));
	return parseInt(tmp)*10;
}

function VisualizzaYear()
{
	//alert(document.getElementById("decade").item(document.getElementById("decade").value).text);
	if(document.getElementById("decade").value != 0)
	{
		document.getElementById("year").innerHTML = "";
		var decadeSelect = parseInt(document.getElementById("decade").item(document.getElementById("decade").value).text);
		var j = 1;
		document.getElementById("year").innerHTML += "<option value='" + 0 +"'>" + "anno" + "</option>";
		for(var i = decadeSelect;i <= decadeSelect + 9;i++)
		{
			document.getElementById("year").innerHTML += "<option value='" + j +"'>" + i + "</option>";
			j++;
		}
        $('#year').fadeIn('slow');
	}
}

function VisualizzaMonth()
{
	//alert(document.getElementById("decade").item(document.getElementById("decade").value).text);
	if(document.getElementById("year").value != 0)
	{
		document.getElementById("month").innerHTML = "";
		var yearSelect = parseInt(document.getElementById("year").item(document.getElementById("year").value).text);
		document.getElementById("month").innerHTML += "<option value='" + 0 +"'>" + "mese" + "</option>";
		var tmp = $.getJSON('json/month.json',function(tmp)
		{ //return timeline				
			for (var i = 1; i < tmp.length+1; i++) {
				document.getElementById("month").innerHTML += "<option value='" + i +"'>" + tmp[i-1].name + "</option>";
			}
		});
        $('#month').fadeIn('slow');
	}
}

function VisualizzaDay()
{
	//alert(document.getElementById("decade").item(document.getElementById("decade").value).text);
	if(document.getElementById("month").value != 0)
	{
		document.getElementById("day").innerHTML = "";
		var monthSelect = document.getElementById("month").item(document.getElementById("month").value).text;
		var j = 1;
		document.getElementById("day").innerHTML += "<option value='" + 0 +"'>" + "giorno" + "</option>";
		/*for(var i = 1;i <= 31;i++)
		{
			document.getElementById("day").innerHTML += "<option value='" + i +"'>" + i + "</option>";
			j++;
		}*/
		switch(monthSelect)
		{
			case "Gennaio":
			case "Marzo":
			case "Maggio":
			case "Luglio":
			case "Agosto":
			case "Ottobre":
			case "Dicembre" :
				for(var i = 1;i <= 31;i++)
				{
					document.getElementById("day").innerHTML += "<option value='" + i +"'>" + i + "</option>";
					j++;
				}
				break;
			case "Aprile":
			case "Giugno":
			case "Settembre":
			case "Novembre":
				for(var i = 1;i <= 30;i++)
				{
					document.getElementById("day").innerHTML += "<option value='" + i +"'>" + i + "</option>";
					j++;
				}
				break;
			case "Febbraio":
				for(var i = 1;i <= 28;i++)
				{
					document.getElementById("day").innerHTML += "<option value='" + i +"'>" + i + "</option>";
					j++;
				}
				break;
		}
		
        $('#day').fadeIn('slow');
	}
}
</script>
</head>
<body>
<div id="divRoot">
<input class="timeline" id="1940" type="image" src="button/1940.jpg">
<input class="timeline" id="1950" type="image" src="button/1950.jpg">
<input class="timeline" id="1960" type="image" src="button/1960.jpg">
<input class="timeline" id="1970" type="image" src="button/1970.jpg">
<input class="timeline" id="1980" type="image" src="button/1980.jpg">
<input class="timeline" id="1990" type="image" src="button/1990.jpg">
<br/>
<div id="centrale">
  <div id="NoResults" style="display:none;">
    <div style="background-color:#FFF; padding-bottom:30px; padding-top:100px;">
      <label id="lbldebug">Non ci sono ancora storie del 1950!</label>
    </div>
    <button style="margin-top:100px;" id="RaccontaciUnaStoria" class="btn btn-large btn-primary" onClick="ApriOverlay();">Raccontaci una storia</button>
    <br>
    
   <!-- <div class="divFoto" style="height:300px; margin-top:100px; padding-left:5px; padding-right:5px; width:440px;">
    	<h3>Domande sul periodo</h3>    
   		<button style="margin-top:40px;" id="FirstDecadeQuestionEmpty" class="btn btn-primary" onClick="ApriOverlay(this.id);"></button>
        <br>
    	<button style="margin-top:40px;" id="SecondDecadeQuestionEmpty" class="btn btn-primary" onClick="ApriOverlay(this.id);"></button>
    </div>
    
    <div class="divFoto" style="height:300px;margin-top:100px;padding-left:5px; padding-right:5px;width:440px;">
    	<h3>Domande personali sul periodo</h3>  
    	<button style="margin-top:40px;" id="FirstPersonalQuestionEmpty" class="btn btn-primary" onClick="ApriOverlay(this.id);"></button>
        <br>
    	<button style="margin-top:40px;" id="SecondPersonalQuestionEmpty" class="btn btn-primary" onClick="ApriOverlay(this.id);"></button>
    </div>-->
    
    <div style="background-color: #CCC;width: 486px; padding:2px 2px 2px 2px;margin-left:10px;margin-right:10px;float: left; margin-top:200px; height:80px; -moz-border-radius: 5px 5px 5px 5px;-webkit-border-radius: 5px 5px 5px 5px;	border-radius: 5px 5px 5px 5px;">
    	<span id="FirstDecadeQuestionEmpty"></span><br>
    	<button class="btn btn-primary" style="margin-top:2px;" onClick="ApriOverlay('FirstDecadeQuestionEmpty');">Raccontaci!</button>
        <button class="btn btn-primary" style="margin-top:2px;" onClick="newQuestion();">Altra domanda</button>
    </div>
    <div style="background-color: #CCC;width: 486px; padding:2px 2px 2px 2px; margin-left:10px;margin-right:10px;float: left; margin-top:200px;height:80px;-moz-border-radius: 5px 5px 5px 5px;-webkit-border-radius: 5px 5px 5px 5px;	border-radius: 5px 5px 5px 5px;">
    	<span id="SecondDecadeQuestionEmpty"></span><br>
    	<button class="btn btn-primary" style="margin-top:2px;" onClick="ApriOverlay('SecondDecadeQuestionEmpty');">Raccontaci!</button>
        <button class="btn btn-primary" style="margin-top:2px;" onClick="newQuestion());">Altra domanda</button>
    </div>
    
    <div style="background-color: #CCC;width: 486px; padding:2px 2px 2px 2px;margin-left:10px;margin-right:10px;float: left; margin-top:20px; height:80px;-moz-border-radius: 5px 5px 5px 5px;-webkit-border-radius: 5px 5px 5px 5px;	border-radius: 5px 5px 5px 5px;">
    	<span id="FirstPersonalQuestionEmpty"></span><br>
    	<button class="btn btn-primary" style="margin-top:2px;" onClick="ApriOverlay('FirstPersonalQuestionEmpty');">Raccontaci!</button>
        <button class="btn btn-primary" style="margin-top:2px;" onClick="newQuestion();">Altra domanda</button>
    </div>
    <div style="background-color: #CCC;width: 486px; padding:2px 2px 2px 2px; margin-left:10px;margin-right:10px;float: left; margin-top:20px;height:80px;-moz-border-radius: 5px 5px 5px 5px;-webkit-border-radius: 5px 5px 5px 5px;	border-radius: 5px 5px 5px 5px;">
    	<span id="SecondPersonalQuestionEmpty"></span><br>
    	<button class="btn btn-primary" style="margin-top:2px;" onClick="ApriOverlay('SecondPersonalQuestionEmpty');">Raccontaci!</button>
        <button class="btn btn-primary" style="margin-top:2px;" onClick="newQuestion());">Altra domanda</button>
    </div>
    
  </div>
  <div id="Results" style="display:none;">
  
    <div class="navbar">
      <div class="navbar-inner">
        <ul class="nav">
          <li class="active" id="liFoto"><a href="#">Foto</a> </li>
          <li id="liStorie"><a href="#">Storie</a></li>
          <li id="liCanzoni"><a href="#">Canzoni</a></li>
          <li id="liFamosi"><a href="#">Famosi</a></li>
          <li id="liRaccontaci"><a href="#">Raccontaci</a></li>
          <li id="liLogout"><a href="#">Logout</a></li>
        </ul>
      </div>
    </div>
    
    <div style="background-color: #CCC;width: 486px; padding:2px 2px 2px 2px;margin-left:10px;margin-right:10px;float: left; margin-top:-10px; height:80px;-moz-border-radius: 5px 5px 5px 5px;-webkit-border-radius: 5px 5px 5px 5px;	border-radius: 5px 5px 5px 5px;">
    	<span id="DecadeQuestionNotEmpty"></span><br>
    	<button class="btn btn-primary" style="margin-top:2px;" onClick="ApriOverlay('DecadeQuestionNotEmpty');">Raccontaci!</button>
        <button class="btn btn-primary" style="margin-top:2px;" onClick="newQuestion();">Altra domanda</button>
    </div>
    <div style="background-color: #CCC;width: 486px; padding:2px 2px 2px 2px; margin-left:10px;margin-right:10px;float: left; margin-top:-10px;height:80px;-moz-border-radius: 5px 5px 5px 5px;-webkit-border-radius: 5px 5px 5px 5px;	border-radius: 5px 5px 5px 5px;">
    	<span id="PersonalQuestionNotEmpty"></span><br>
    	<button class="btn btn-primary" style="margin-top:2px;" onClick="ApriOverlay('PersonalQuestionNotEmpty');">Raccontaci!</button>
        <button class="btn btn-primary" style="margin-top:2px;" onClick="newQuestion());">Altra domanda</button>
    </div>
    
    <div id="Foto">
      <div class="divFoto">
        <h3 id="FotoDelTempo">Com'era questo posto attorno al 1950</h3>
        <div id="divFotoDelTempo" style="overflow:auto;height:469px;">         
          <!--<a class="fancybox" rel="gallery1" href="img/comera1.jpg" title="2 ottobre 1950 - nasce il fumetto Charlie Brown, dalla penna di Charles M. Schulz..."> <img src="img/comera1.jpg" alt="" /> </a> 
          <a class="fancybox" rel="gallery1" href="img/comera3.jpg" title="09 maggio 1950 - Nasce la comunitÃ  europea..."> <img src="img/comera3.jpg" alt="" /> </a> 
          <a class="fancybox" rel="gallery1" href="img/comera2.jpg" title="26 gennaio 1950 - L'india diventa una repubblica.."> <img src="img/comera2.jpg" alt="" /> </a> --> 
          <!--<img style="width:600px;" src="img/comera3.jpg" alt="" />
          <img src="img/comera3.jpg" alt="" /><img src="img/comera3.jpg" alt="" />
          <img src="img/comera3.jpg" alt="" />
          <img src="img/comera3.jpg" alt="" />-->
        </div>
      </div>
      <div class="divFoto">
        <h3 id="TueFotoDelTempo" >Le tue foto attorno al 1950</h3>
        <div id="divMieFotoDelTempo" style="overflow:auto;height:469px;"> 
          
          <!--<a class="fancybox" rel="gallery1" href="img/tuefoto1.jpg" title="Foto 1"> <img src="img/tuefoto1.jpg" alt=""/> </a> 
          <a class="fancybox" rel="gallery1" href="img/tuefoto2.jpg" title="Foto 2"> <img src="img/tuefoto2.jpg" alt="" /> </a> 
          <a class="fancybox" rel="gallery1" href="img/tuefoto3.jpg" title="Foto 3"> <img src="img/tuefoto3.jpg" alt="" /> </a>--> </div>
      </div>
    </div>
    <div id="Storie" style="display:none;">
      <div class="divFoto">
        <h3 id="StorieDelTempo">Che cosa succedeva nel 1950</h3>
        <div id="divStorieDelTempo" style="overflow:auto;height:469px;"> 
        <div style=" width:440px; border-style:solid;border-width:2px;border-color:#000; height:140px; margin-left:25px; margin-bottom:5px;">
        	<div style=" float:left; width:110px; text-align:center; height:140px;">
            	<h3>1950</h3>
                <h5>Trento</h5>
            </div>
            <div style=" float:left;width:216px; text-align:center;background: rgba(0,0,0,0.7);color: #FFF;height:136px; padding: 2px; text-align:left;">
            <h3 style="text-align:center;">Prova</h3>
            nasce il fumetto Charlie Brown, dalla penna di Charles M. Schulz...
            </div>
            <div style="float:left;width:110px; text-align:center;background: rgba(0,0,0,0.7);color: #FFF;height:140px; line-height:140px; vertical-align:middle;">
            <img style="max-width:110px;" src="img/comera3.jpg" alt="" />
            </div>
        </div>
        
        </div>
        
        <!--<div class="immagini">
            <div class="text"> 26 gennaio 1950 - L'india diventa una repubblica </div>
            <img src="img/comera2.jpg" /> </div>
          <div class="immagini">
            <div class="text"> 2 ottobre 1950 - nasce il fumetto Charlie Brown, dalla penna di Charles M. Schulz... </div>
            <img src="img/comera1.jpg" /> </div>
          <div class="immagini">
            <div class="text"> 09 maggio 1950 - Nasce la comunità europea... </div>
            <img src="img/comera3.jpg" /> </div>
--> 	</div>
      <div class="divFoto">
        <h3 id="TueStorieDelTempo">Le tue storie nel 1950</h3>
        <!--<img src="img/tuefoto2.jpg" /> </div>-->
        <div id="divMieStorieDelTempo" style="overflow:auto;height:469px;"> </div>
      </div>
    </div>
    <div id="Canzoni" style="display:none;">
      <!--<h1>Quali erano le canzoni pi&uacute; popolari?</h1>-->
      <div class="divFoto">
        <iframe width="420" height="315" src="http://www.youtube.com/embed/CwE8GcoqEfw" frameborder="0" allowfullscreen style="margin-top:30px;"></iframe>
        <h3>Matia Bazar - Cavallo bianco</h3>
      </div>
      <div class="divFoto">
        <iframe width="420" height="315" src="http://www.youtube.com/embed/MKahSufwWS0" frameborder="0" allowfullscreen style="margin-top:30px;"></iframe>
        <h3>Patty Pravo - Pensiero Stupendo</h3>
      </div>
    </div>
    <div id="Famosi" style="display:none;">
      <div class="divFoto">
        <h3>Chi &eacute; nato all'epoca</h3>
        <img src="img/Loredana.jpg" class="round"/>
        <h4>Loredana Bert&eacute;</h4>
        <h6>Non &eacute; una signora, &eacute; costantemente</br>
          depressa e in lotta con il </br>
          mondo, difficile da gestire...</h6>
      </div>
      <div class="divFoto">
        <h3>Chi era famoso all'epoca</h3>
        <img src="img/DiPietro.jpg" class="round"/>
        <h4>Antonio di Pietro</h4>
        <h6>Nato il 2 ottobre 1950 a Montenero</br>
          di Bisaccia (CB), &eacute; l'uomo simbolo di</br>
          quella stagione politica che va...</h6>
      </div>
    </div>
    
  </div>
  <div class="overlay" id="overlay" style="display: none;"></div>
  <!--contenuto overlay-->
  <div id="box">
    <div style="background-color:#D5D5D5; padding-top:10px;">
      <div style="background-color:#A05152; padding-bottom:10px; padding-top:10px;">
        <label id="titleBox">raccontaci la tua storia</label>
        <button id="salva" onClick="salvaStoria();" class="btn btn-primary">Salva</button>
      </div>
      <div style="margin-top:10px; color:#000; margin-left:20px; margin-right:20px;">
        <form>
          <div>
            <label for="titolo" style="float:left; margin-top:3px;">Titolo:</label>
            <input id="titolo" style="float:left; margin-left:30px;" class="input-xxlarge" type="text"/>
          </div>
          <br/>
          <br/>
          <div>
            <label for="dove" style="float:left;margin-top:3px;">Dove:</label>
            <input id="dove" style="float:left; margin-left:30px;" type="text" class="input-xlarge"/>
            <label for="quando" style="float:left;margin-top:3px; margin-left:30px;">Quando:</label>
            <!--<input id="dove" style="float:left; margin-left:3px;" type="text" class="input-xlarge"/>-->
            <!--<div style="float:left; margin-left:15px;">
              <input id="quando" value="10/10/2011" />
            </div>-->
            <select id="decade" size="1" style="width:90px;" onChange="VisualizzaYear();">
			</select>
            <!--<input id="year" value=""/>-->
            <select id="year" size="1" style="width:80px;display:none" onChange="VisualizzaMonth();">
			</select>
            <select id="month" size="1" style="width:120px;display:none" onChange="VisualizzaDay();">
			</select>
            <select id="day" size="1" style="width:80px;display:none">
			</select>
            </br>
          </div>
        </form>
      </div>
      <div style="float:left; margin:20px;"> 
        <!--<button onClick="editor();">Editor</button>--> 
        <!--<input type="image" src="button/buttonFoto.jpg" onClick="capturePhoto();">--> 
        <br/>
        <input id="record" type="image" style="margin-top:10px;" src="button/buttonMicrofono.jpg" onClick="record();">
        <br/>
        <h3 style="color:#FF0;" id="time">0:00</h3>
        <input id="play" type="image" style="margin-top:10px; visibility:hidden;" src="button/buttonPlay.png" onClick="play();">
        <input id="stop" type="image" style="margin-top:10px; margin-left:2px; visibility:hidden;" src="button/buttonStop.png" onClick="stop();">
      </div>
      <div style="float:left; margin-right:20px;"> <span class="btn btn-success fileinput-button">
        		<input id="fileupload" type="file" name="files[]" multiple>
        </span> <br><br>        
        <div id="progress" class="progress progress-success progress-striped">
          <div class="bar"></div>
        </div>
        <div id="imgInput" style="overflow:auto;height:400px;">
        </div>
      </div>
        <textarea  id="editor" rows="10" cols="30" style="width:480px;height:525px; float:left;">
    
      </textarea>
      
    </div>
    <img src="images/X.png" class="chiudi" /> </div>
</div>

<!--fine box--> 

<!--<button onClick="storage();">Storage</button>--> 
<!--<label id="debug"></label>-->
<div class="overlay" id="overlayCaricamento" style="display: none;"></div>
<img src="images/caricamento.gif" id="caricamento"/>
</body>
</html>
<!DOCTYPE HTML>
<html>
<head>
<title>Reminiscens</title>
<!--<script src="cordova-2.4.0.js"></script>-->
<script src="cordova.js"></script>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<script src="http://code.jquery.com/jquery.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>

<script type="text/javascript" src="js/json/json2.js"></script>
<script type="text/javascript" src="js/sha1.js"></script>

<script type="text/javascript" src="js/storage/jquery.storageapi.js"></script>
<script type="text/javascript" src="js/storage/jquery.cookie.js"></script>
<script type="text/javascript" src="js/GestioneVariabiliPersona.js"></script>
<script>  	
     function onLoad(){
          document.addEventListener("deviceready", onDeviceReady, true);
     }
     function onDeviceReady(){
          navigator.notification.alert("PhoneGap is working!!");
     }
	function Redirect()
	{
		location.href = "registra.html";
	}
	function Login()
	{		
		var sessionData = new Object;

    	sessionData.email = $("#email").val();
		//alert($("#email").val());
		//sessionData.email = "reminiscensapp+4@gmail.com";

    	//sessionData.password = $.sha1($("#password").val());
		sessionData.password = $("#password").val();  
		//alert($("#password").val());   
		//sessionData.password = "testing-password";  
		
		//alert(JSON.stringify(sessionData));         

    	$.ajax({
        	type: "POST",

    	    //url: "http://test.reminiscens.me/lifeapi/user/login",
        	url: "http://base.reminiscens.me/lifeapi/user/login",

        	data: JSON.stringify(sessionData),
			
			//data:{"email":"reminiscensapp+4@gmail.com","password":"testing-password"},

        	async: false,

        	success: function (data) {

            	//alert(data.sessionKey);
				SetSessionKey(data.sessionKey);
				//alert(data.userId);
				SetPersonId(data.person.personId);				
				SetPersonBirthDate(data.person.birthdateAsString);
				SetPersonDeacadeBirthDate(parseInt(data.person.birthdateAsString.split('-')[0]/10)*10);
				SetPersonYearBirthDate(data.person.birthdateAsString.split('-')[0]);
				location.href = "main.html";

        	},
        	error: function (data) {
				alert("L'email o la password inseriti sono sbagliati");

        	},
        	dataType: "json",
			
			contentType: "application/json"

        });
	}
	
	$(document).ready(function () {
	    SetBaseUrl("http://test.reminiscens.me");
	    /*if (window.location.hostname == "http://test.reminiscens.me") {
	        SetBaseUrl("http://test.reminiscens.me");
	    }
	    else {
	        SetBaseUrl("http://base.reminiscens.me");
	    }*/
		if(GetSessionKey() != "" && GetSessionKey()!= null)
		{
			location.href = "main.html";
		}
	});
</script>

<style>
body {
	background-color:#CCC;
	background-repeat: repeat-y;
}
#divRoot{
	width: 450px;
	height: 240px;
	margin: auto;
	margin-top:20px;
	-moz-border-radius: 10px 10px 10px 10px;
	-webkit-border-radius: 10px 10px 10px 10px;
	border-radius: 10px 10px 10px 10px;
	background-color:#FFF;
}
.cont{
	text-align: center;
	height: 70px;
	width: 450px;
	vertical-align: central;
	margin: auto;
}

</style>
</head>
<body>
<div id="divRoot">
  <div class="cont" style="padding-left:20px;">
    <h3 style="color:#999; float:left;">Email:</h3>
    <input id="email" style="float:left; margin-top:15px; margin-left:60px;" type="text" placeholder="email" autofocus>
    </div>
  <div class="cont" style="padding-left:20px;height:100px;">
    <h3 style="color:#999; float:left;">Password:</h3>
    <input id="password" style="float:left; margin-top:15px; margin-left:10px;" type="password" placeholder="password">
  </div>
  <div class="cont">
  	<button onClick="Redirect()" class="btn btn-primary">Registrati</button>
    <button onClick="Login()" class="btn btn-primary">Login</button>
  </div>
</div>
</html>